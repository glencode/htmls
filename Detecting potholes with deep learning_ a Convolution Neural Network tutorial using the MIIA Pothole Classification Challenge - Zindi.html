<!DOCTYPE html>
<!-- saved from url=(0153)https://zindi.africa/learning/detecting-potholes-with-deep-learning-a-convolution-neural-network-tutorial-using-the-miia-pothole-classification-challenge -->
<html lang="en" class="wf-nunito-n3-active wf-nunito-n4-active wf-active"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- nextgen -->
    
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://assets.zindi.africa/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://assets.zindi.africa/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://assets.zindi.africa/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://assets.zindi.africa/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://assets.zindi.africa/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://assets.zindi.africa/apple-touch-icon-152x152.png">
    <link rel="icon" type="image/png" href="https://assets.zindi.africa/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://assets.zindi.africa/favicon-16x16.png" sizes="16x16">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@ZindiAfrica">
    <meta name="application-name" content=" ">
    <meta name="msapplication-TileColor" content="#FFFFFF">
    <meta name="msapplication-TileImage" content="https://assets.zindi.africa/mstile-144x144.png">
    <script async="" src="./Detecting potholes with deep learning_ a Convolution Neural Network tutorial using the MIIA Pothole Classification Challenge - Zindi_files/tag.js"></script><script async="" src="./Detecting potholes with deep learning_ a Convolution Neural Network tutorial using the MIIA Pothole Classification Challenge - Zindi_files/gtm.js"></script><script src="./Detecting potholes with deep learning_ a Convolution Neural Network tutorial using the MIIA Pothole Classification Challenge - Zindi_files/webfont.js" async=""></script><script type="text/javascript">
      var WebFontConfig = {
        google: {
          families: ["Nunito:300,400"],
        },
        timeout: 2000,
      }

      ;(function (d) {
        var h = d.documentElement
        var onerror = function () {
          h.className += "wf-inactive"
        }
        var st = setTimeout(onerror, 1000)
        h.className += "wf-loading"
        var wf = d.createElement("script"),
          s = d.scripts[0]
        wf.src = "https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"
        wf.async = true
        wf.onerror = onerror
        wf.onload = function () {
          clearTimeout(st)
        }
        s.parentNode.insertBefore(wf, s)
      })(document)
    </script>
    <title>Detecting potholes with deep learning: a Convolution Neural Network tutorial using the MIIA Pothole Classification Challenge - Zindi</title><meta data-react-helmet="true" name="description" content="Zindi is a data science competition platform with the mission of building the data science ecosystem in Africa. Zindi hosts a community of data scientists dedicated to solving the continent&#39;s most pressing problems through machine learning and artificial intelligence."><meta data-react-helmet="true" property="og:site_name" content="Zindi"><meta data-react-helmet="true" property="twitter:site_name" content="Zindi"><meta data-react-helmet="true" property="og:title" content="Detecting potholes with deep learning: a Convolution Neural Network tutorial using the MIIA Pothole Classification Challenge"><meta data-react-helmet="true" property="og:description" content="In this post, we will use deep learning to build a simple model that can automatically detect potholes in images of roads.Detecting and fixing potholes is an important aspect of public road maintenance; left unchecked, they can cause major damage to vehicles and have long-term economic consequences. Studies show that the South African government spent over R22 billion over the past 3 years on pothole repair programs. Potholes also pose a serious danger to motorists, but manually identifying can be a daunting task and a time-consuming exercise."><meta data-react-helmet="true" property="og:image" content="https://zindpublic.blob.core.windows.net/public/uploads/blog_post/image/58/big_thumb_26e84c40-c1d8-4622-a5c9-2297eaea87b4.png"><meta data-react-helmet="true" property="twitter:title" content="Detecting potholes with deep learning: a Convolution Neural Network tutorial using the MIIA Pothole Classification Challenge"><meta data-react-helmet="true" property="twitter:description" content="In this post, we will use deep learning to build a simple model that can automatically detect potholes in images of roads.Detecting and fixing potholes is an important aspect of public road maintenance; left unchecked, they can cause major damage to vehicles and have long-term economic consequences. Studies show that the South African government spent over R22 billion over the past 3 years on pothole repair programs. Potholes also pose a serious danger to motorists, but manually identifying can be a daunting task and a time-consuming exercise."><meta data-react-helmet="true" property="twitter:image" content="https://zindpublic.blob.core.windows.net/public/uploads/blog_post/image/58/big_thumb_26e84c40-c1d8-4622-a5c9-2297eaea87b4.png">
    
    <script>
      ;(function (w, d, s, l, i) {
        w[l] = w[l] || []
        w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" })
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != "dataLayer" ? "&l=" + l : ""
        j.async = true
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl
        f.parentNode.insertBefore(j, f)
      })(window, document, "script", "dataLayer", "GTM-KRG85D8")
    </script>
    
  <link rel="stylesheet" href="./Detecting potholes with deep learning_ a Convolution Neural Network tutorial using the MIIA Pothole Classification Challenge - Zindi_files/css" media="all"><link href="./Detecting potholes with deep learning_ a Convolution Neural Network tutorial using the MIIA Pothole Classification Challenge - Zindi_files/bundle.d57dc7d8a01460a702c7.css" rel="stylesheet"></head>
  <body _c_t_common="1" data-new-gr-c-s-check-loaded="14.1020.0" data-gr-ext-installed="">
    <noscript> You need to enable JavaScript to run this app. </noscript>
    <div id="app"><div class="App__container___fj0c9"><div class="App__section___1nGff"></div><div class="App__section___1nGff"><div class="App__contained___3emDO"><div class="Header__container___3FtbH"><a href="https://zindi.africa/"><div class="Header__logo___1eRaO">Zindi</div></a><div class="Header__menuContainer___2izgT"><div class="Menu__container___1sjgb"><a class="Menu__link___3x4C4" href="https://zindi.africa/competitions"><span class="Menu__linkInner___3LB5N">Compete</span></a><a aria-current="page" class="Menu__link___3x4C4 Menu__activeLink___1MA6r" href="https://zindi.africa/learning"><span class="Menu__linkInner___3LB5N">Learn</span></a><a class="Menu__link___3x4C4" href="https://zindi.africa/jobs"><span class="Menu__linkInner___3LB5N">Find a Job</span></a></div><div class="Menu__container___1sjgb Header__menuRight___3wiDe Menu__justifyRight___3r6Ws"><a class="Menu__link___3x4C4" href="https://zindi.africa/inbox"><span class="Menu__linkInner___3LB5N"><div class="Inbox__container___3xHCr"><svg class="Inbox__messagesIcon___2XP8V" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg><div class="Inbox__unseen___31NED"></div></div></span></a></div></div><div class="Header__userMenu___2iOts"><div class="UserMenu__container___ypkko"><button class="Button__base___NhksY Button__blank-normal___1nB5F UserMenu__user___a0zJo"><span class="Button__inner___3jkeF"><span class="User__container___18HoF User__size-normal___26ZPA"><img class="User__avatar___6aNx2" src="./Detecting potholes with deep learning_ a Convolution Neural Network tutorial using the MIIA Pothole Classification Challenge - Zindi_files/thumb.default.png" alt=""><span class="User__username___64PE2">Glencode</span></span></span></button><div class=""></div></div></div></div></div></div><div class="App__section___1nGff App__content___WFkDX"><div class="WithSubheader__container___3qd5U"><div class="WithSubheader__header___2o1oX WithSubheader__withHeader___35ECw"><div class="BlogPost__headerImage___2fAz4" style="background-image: url(&quot;https://zindpublic.blob.core.windows.net/public/uploads/blog_post/image/58/header_26e84c40-c1d8-4622-a5c9-2297eaea87b4.png&quot;);"></div></div><div><div class="App__contained___3emDO"><div class="Paper__paper___2M-1R Paper__padding-1___3sKLR BlogPost__paper___1D3Be"><div class="BlogPost__date___3BhZy">16 Apr 2020, 15:59</div><h2 class="BlogPost__title___RUU5Z">Detecting potholes with deep learning: a Convolution Neural Network tutorial using the MIIA Pothole Classification Challenge</h2><div class="Html__container___1AJFz BlogPost__intro___31fc-"><p>In this post, we will use deep learning to build a simple model that can automatically detect potholes in images of roads.</p><p>Detecting and fixing potholes is an important aspect of public road maintenance; left unchecked, they can cause major damage to vehicles and have long-term economic consequences. Studies show that the South African government spent over R22 billion over the past 3 years on pothole repair programs. Potholes also pose a serious danger to motorists, but manually identifying can be a daunting task and a time-consuming exercise.</p><p><span style="font-weight: bold;" class="">Datasets</span></p><p>A bit of background about the dataset: the MIIA Pothole Image Classification Challenge was designed for Leaderex and AI Expo, taking place on 3 and 4 September 2019, respectively. The data contains images of streets in South Africa that either have potholes or do not. The data is split into a test and train set; the training set contains 4,026 images, while the test set contains 1,650 images. The data can be found here. This is a knowledge competition which means it stays open permanently and anyone can try it.</p><p><span style="font-weight: bold;" class="">Model </span></p><p>For this problem, we will build a Convolution Neural Network (CNN) using a Jupyter notebook. We will upload the images and train them. The images are in RGB (Red, Green, Blue) format;  <a href="https://en.wikipedia.org/wiki/RGB_color_model" target="_blank" rel="noreferrer noopener">you can read more about RGB here</a>.     </p><p>For the steps below, <a href="https://github.com/blessingkoketso/Pothole_Detection" target="_blank" rel="noreferrer noopener">follow along with my code on Github</a>.</p><p>Image labeling</p><p>The data is divided into two folders, one for training and the other for testing. The training folder contains the training images which we will use to train the model.</p><p>We will create a vector to hold the training images. We use the load_img function from numpy to import the images into the Jupyter environment. The load_img converts the RGB images into numbers between 0 and 255. We use a for-loop to mark each image using their image id and format. We then append the images onto each other and store them in an array. The code snippet will create the above-mentioned process.</p><div class="codeblock"><pre><span style="font-family: &quot;SFMono-Regular&quot;,Consolas,&quot;Liberation Mono&quot;,Menlo,Courier,monospace;" class="codeinline"># We have grayscale images,  so while loading the images we will keep grayscale=True,</span>
<span style="font-family: &quot;SFMono-Regular&quot;,Consolas,&quot;Liberation Mono&quot;,Menlo,Courier,monospace;" class="codeinline"># if you have RGB images, you should set grayscale as false</span>
<span style="font-family: &quot;SFMono-Regular&quot;,Consolas,&quot;Liberation Mono&quot;,Menlo,Courier,monospace;" class="codeinline">train_image = []</span>
<span style="font-family: &quot;SFMono-Regular&quot;,Consolas,&quot;Liberation Mono&quot;,Menlo,Courier,monospace;" class="codeinline">for i in tqdm(range(train.shape[0])):</span>
    <span style="font-family: &quot;SFMono-Regular&quot;,Consolas,&quot;Liberation Mono&quot;,Menlo,Courier,monospace;" class="codeinline">img = image.load_img(train['image_ID'][i]+'.JPG', target_size=(28,28,1), grayscale=False)</span>
    <span style="font-family: &quot;SFMono-Regular&quot;,Consolas,&quot;Liberation Mono&quot;,Menlo,Courier,monospace;" class="codeinline">img = image.img_to_array(img)</span>
    <span style="font-family: &quot;SFMono-Regular&quot;,Consolas,&quot;Liberation Mono&quot;,Menlo,Courier,monospace;" class="codeinline">img = img/255</span>
    <span style="font-family: &quot;SFMono-Regular&quot;,Consolas,&quot;Liberation Mono&quot;,Menlo,Courier,monospace;" class="codeinline">train_img.append(img)</span>
<span style="font-family: &quot;SFMono-Regular&quot;,Consolas,&quot;Liberation Mono&quot;,Menlo,Courier,monospace;" class="codeinline">X = np.array(train_image)</span></pre></div><p><span style="font-weight: bold;" class="">Apply transformations</span></p><p>After storing the training images into a vector, we split them in two sets by using the 20/80 rule. We will use 80 percent of the images to train the model and the other 20 percent to test it. </p><p>Now we set up the convolutional neural network (CNN). Since we are building the CNN from scratch we need to specify a few parameters associated with the model. We specify the input shape to be the same size as the vector holding the images. For the pooling layer we use a size of 2. The dropout is 0.25 and for the activation function we use a softmax.</p><div class="codeblock"><pre><span style="font-family: &quot;SFMono-Regular&quot;,Consolas,&quot;Liberation Mono&quot;,Menlo,Courier,monospace;" class="codeinline">model = Sequential()</span>
<span style="font-family: &quot;SFMono-Regular&quot;,Consolas,&quot;Liberation Mono&quot;,Menlo,Courier,monospace;" class="codeinline">model.add(Conv2D(32, kernel_size=(3, 3),activation='relu',input_shape=(28,28,1)))</span>
<span style="font-family: &quot;SFMono-Regular&quot;,Consolas,&quot;Liberation Mono&quot;,Menlo,Courier,monospace;" class="codeinline">model.add(Conv2D(64, (3, 3), activation='relu'))</span>
<span style="font-family: &quot;SFMono-Regular&quot;,Consolas,&quot;Liberation Mono&quot;,Menlo,Courier,monospace;" class="codeinline">model.add(MaxPoolong2D(pool_size=2, 2)))</span>
<span style="font-family: &quot;SFMono-Regular&quot;,Consolas,&quot;Liberation Mono&quot;,Menlo,Courier,monospace;" class="codeinline">model.add(Dropout(0.25))</span>
<span style="font-family: &quot;SFMono-Regular&quot;,Consolas,&quot;Liberation Mono&quot;,Menlo,Courier,monospace;" class="codeinline">model.add(Flatten())</span>
<span style="font-family: &quot;SFMono-Regular&quot;,Consolas,&quot;Liberation Mono&quot;,Menlo,Courier,monospace;" class="codeinline">model.add(Dense(128, activation='relu'))</span>
<span style="font-family: &quot;SFMono-Regular&quot;,Consolas,&quot;Liberation Mono&quot;,Menlo,Courier,monospace;" class="codeinline">model.add(Dropout(0.5))</span>
<span style="font-family: &quot;SFMono-Regular&quot;,Consolas,&quot;Liberation Mono&quot;,Menlo,Courier,monospace;" class="codeinline">model.add(Dense(10, activation='softmax'))</span></pre></div><p>The architecture of the CCN is shown below.</p><p></p><div class="image">
<img src="./Detecting potholes with deep learning_ a Convolution Neural Network tutorial using the MIIA Pothole Classification Challenge - Zindi_files/d6574252-ffaa-4217-90a7-056788cd90ce.png"> </div><p></p><p><span style="font-weight: bold;" class="">Model training</span></p><p>We train the model by using an Adam optimiser, and set the epochs to 10.  For the objective function we use a ‘sparse categorical cross-entropy’ and we set our metric to accuracy since we’re interested in measuring the log loss of the model. Logarithmic loss (related to cross-entropy) measures the performance of a classification model where the prediction input is a probability value between 0 and 1. <a href="http://wiki.fast.ai/index.php/Log_Loss" target="_blank" rel="noreferrer noopener">You can read more about log loss here</a>. After defining those parameters, we fit the model on the training data.</p><div class="codeblock">
<pre>model.compile(loss='sparse_categorical_crossentropy, optimizer='Adam',metrics=['accuracy'])
model.fit(X_train, y_train,epochs=10) </pre>
<pre>Epoch 1/10
3220/3220 [==============================] - 7s 2ms/step - loss: 0.4589 - acc: 0.7870
Epoch 2/10
3220/3220 [==============================] - 7s 2ms/step - loss: 0.3132 - acc: 0.8618
Epoch 3/10
3220/3220 [==============================] - 7s 2ms/step - loss: 0. 2594 - acc: 0.8910
Epoch 4/10
3220/3220 [==============================] - 7s 2ms/step - loss: 0.2341 - acc: 0.8994
Epoch 5/10
3220/3220 [==============================] - 7s 2ms/step - loss: 0.2005 - acc: 0.9168
Epoch 6/10
3220/3220 [==============================] - 7s 2ms/step - loss: 0.1740 - acc: 0.9326
Epoch 7/10
3220/3220 [==============================] - 7s 2ms/step - loss: 0.1482 - acc: 0.9407
Epoch 8/10 
3220/3220 [==============================] - 7s 2ms/step - loss: 0.1458 - acc: 0.9422
Epoch 9/10
3220/3220 [==============================] - 7s 2ms/step - loss: 0.1208 - acc: 0.9559
Epoch 10/10
3220/3220 [==============================] - 7s 2ms/step - loss: 0.1264 - acc: 0.9506</pre>
</div><p><span style="font-weight: bold;" class="">Prediction on images</span></p><p>We now apply the model on the test data, this is data the model has never interacted with. The unseen images are 1,650 images. This is the most interesting part, as we now get to see how the model performs.</p><div class="codeblock"><pre>y_score = model.predict_proba(X_test)
print(y_score)
[[9.8533183e-01 1.4668099e-02]
 [9.9933630e-01 4.0945363e-01
 ...
 [7.5465256e-01 2.4534738e-01]
 [3.3280409e-03 9.9667192e-01]
 [7.4173373e-01 2.5826630e-01]]
    test = pd.read_csv('test_ids_only.csv')</pre></div><p></p><p></p><div class="image">
<img src="./Detecting potholes with deep learning_ a Convolution Neural Network tutorial using the MIIA Pothole Classification Challenge - Zindi_files/a20f5fcc-d9a6-4c70-bee2-70edd4fab0b9.jpg"> </div><p></p><div class="codeblock"><pre>Saving the results in a text file.
np.savetxt("sample.csv",sample_submission,deliiter = ",")
Using the clip function to improve the log loss.
sample_submission1 = model.predict_proba(Test).clip(0.1,0.3)
Saving the results in a text file.
np.savetxt("sample.csv",sample_submission1,delimiter = ",")</pre></div><p>The model handled the image quite well. Remember the objective was to detect potholes in an image with high accuracy. The log loss of the model is good.  To improve the model further we can use the clip function. This function maximizes the log loss of the model. The log was 1.43 but using the clip function the log loss is at 0.65.</p><p><span style="font-weight: bold;" class="">Summary</span></p><p>I have shown here how easily you can build CNNs and apply them to real-world applications. All this was achieved using open-source tools, and it only took a few hours to compile this solution.</p><p><span style="font-weight: bold;" class="">About the author</span></p><p>Blessing Magabane is a full stack data scientist at Altron Bytes Managed Solutions (<a href="https://www.linkedin.com/in/blessing-magabane-8b6600ab/" target="_blank" rel="noreferrer noopener">LinkedIn</a> | <a href="https://zindi.africa/users/Blessingkok" target="_blank" rel="noreferrer noopener">Zindi</a> | <a href="https://github.com/blessingkoketso" target="_blank" rel="noreferrer noopener">GitHub</a>). He is passionate about data science and solving problems using machine learning. For collaboration on data science projects, please get in touch with him via LinkedIn.</p></div></div></div></div></div></div><div class="App__section___1nGff"><div class="Footer__container___3vGXM"><div class="App__contained___3emDO"><div class="Footer__links___dDoS-"><div class="Footer__column___1yO21"><div><a href="https://zindi.africa/competitions">Competitions</a></div><div><a href="https://zindi.africa/hackathons">Hackathons</a></div><div><a href="https://zindi.africa/data_scientists">Data Scientists</a></div><div><a href="https://zindi.africa/discussions">Discussions</a></div><div><a href="https://zindi.africa/jobs">Jobs Board</a></div></div><div class="Footer__column___1yO21"><div><a href="https://zindi.africa/hosting_competition">Host competition</a></div><div><a href="https://zindi.africa/about">About Us</a></div><div><a href="https://zindi.africa/partners">Our Partners</a></div><div><a href="https://zindi.africa/contact_us">Contact Us</a></div></div><div class="Footer__column___1yO21"><div><a href="https://zindi.africa/rules">Rules and Guidelines</a></div><div><a href="https://zindi.africa/terms">Terms of Use</a></div><div><a href="https://zindi.africa/privacy">Privacy Policy</a></div><div><a href="https://zindi.africa/faq">FAQs</a></div></div><div class="Footer__column___1yO21"><div><a target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/company/zindi-africa">LinkedIn</a></div><div><a target="_blank" rel="noopener noreferrer" href="https://www.facebook.com/ZindiAfrica-311192052980655">Facebook</a></div><div><a target="_blank" rel="noopener noreferrer" href="https://twitter.com/ZindiAfrica">Twitter</a></div><div><a target="_blank" rel="noopener noreferrer" href="https://www.instagram.com/zindi.africa">Instagram</a></div><div><a target="_blank" rel="noopener noreferrer" href="https://zindi.medium.com/">Medium</a></div><div><a target="_blank" rel="noopener noreferrer" href="https://www.youtube.com/channel/UCQHq2JY2BqY2UTDCmVWyGBw">Youtube</a></div><div><a target="_blank" rel="noopener noreferrer" href="https://github.com/zindiafrica">Github</a></div></div></div><div class="Footer__logo___ZtNwP">Zindi</div></div></div></div></div></div><script>window.__INITIAL_STATE__ = {"blogPosts":{"data":{},"queries":{}},"comments":{"data":{},"queries":{}},"competitionTags":{"data":{},"queries":{}},"competitions":{"data":{},"queries":{}},"conspiracyParticipations":{"data":{},"queries":{}},"discussions":{"data":{},"queries":{}},"fullBlogPosts":{"data":{"detecting-potholes-with-deep-learning-a-convolution-neural-network-tutorial-using-the-miia-pothole-classification-challenge":{"id":"detecting-potholes-with-deep-learning-a-convolution-neural-network-tutorial-using-the-miia-pothole-classification-challenge","image":"https://zindpublic.blob.core.windows.net/public/uploads/blog_post/image/58/header_26e84c40-c1d8-4622-a5c9-2297eaea87b4.png","big_image":"https://zindpublic.blob.core.windows.net/public/uploads/blog_post/image/58/big_thumb_26e84c40-c1d8-4622-a5c9-2297eaea87b4.png","header_image":"https://zindpublic.blob.core.windows.net/public/uploads/blog_post/image/58/header_26e84c40-c1d8-4622-a5c9-2297eaea87b4.png","title":"Detecting potholes with deep learning: a Convolution Neural Network tutorial using the MIIA Pothole Classification Challenge","intro_html":"<p>In this post, we will use deep learning to build a simple model that can automatically detect potholes in images of roads.</p><p>Detecting and fixing potholes is an important aspect of public road maintenance; left unchecked, they can cause major damage to vehicles and have long-term economic consequences. Studies show that the South African government spent over R22 billion over the past 3 years on pothole repair programs. Potholes also pose a serious danger to motorists, but manually identifying can be a daunting task and a time-consuming exercise.</p>","intro_plain":"In this post, we will use deep learning to build a simple model that can automatically detect potholes in images of roads.Detecting and fixing potholes is an important aspect of public road maintenance; left unchecked, they can cause major damage to vehicles and have long-term economic consequences. Studies show that the South African government spent over R22 billion over the past 3 years on pothole repair programs. Potholes also pose a serious danger to motorists, but manually identifying can be a daunting task and a time-consuming exercise.","content_html":"<p><span style=\"font-weight: bold;\" class=\"\">Datasets</span></p><p>A bit of background about the dataset: the MIIA Pothole Image Classification Challenge was designed for Leaderex and AI Expo, taking place on 3 and 4 September 2019, respectively. The data contains images of streets in South Africa that either have potholes or do not. The data is split into a test and train set; the training set contains 4,026 images, while the test set contains 1,650 images. The data can be found here. This is a knowledge competition which means it stays open permanently and anyone can try it.</p><p><span style=\"font-weight: bold;\" class=\"\">Model </span></p><p>For this problem, we will build a Convolution Neural Network (CNN) using a Jupyter notebook. We will upload the images and train them. The images are in RGB (Red, Green, Blue) format;  <a href=\"https://en.wikipedia.org/wiki/RGB_color_model\" target=\"_blank\" rel=\"noreferrer noopener\">you can read more about RGB here</a>.     </p><p>For the steps below, <a href=\"https://github.com/blessingkoketso/Pothole_Detection\" target=\"_blank\" rel=\"noreferrer noopener\">follow along with my code on Github</a>.</p><p>Image labeling</p><p>The data is divided into two folders, one for training and the other for testing. The training folder contains the training images which we will use to train the model.</p><p>We will create a vector to hold the training images. We use the load_img function from numpy to import the images into the Jupyter environment. The load_img converts the RGB images into numbers between 0 and 255. We use a for-loop to mark each image using their image id and format. We then append the images onto each other and store them in an array. The code snippet will create the above-mentioned process.</p><div class=\"codeblock\"><pre><span style='font-family: \"SFMono-Regular\",Consolas,\"Liberation Mono\",Menlo,Courier,monospace;' class=\"codeinline\"># We have grayscale images,  so while loading the images we will keep grayscale=True,</span>\n<span style='font-family: \"SFMono-Regular\",Consolas,\"Liberation Mono\",Menlo,Courier,monospace;' class=\"codeinline\"># if you have RGB images, you should set grayscale as false</span>\n<span style='font-family: \"SFMono-Regular\",Consolas,\"Liberation Mono\",Menlo,Courier,monospace;' class=\"codeinline\">train_image = []</span>\n<span style='font-family: \"SFMono-Regular\",Consolas,\"Liberation Mono\",Menlo,Courier,monospace;' class=\"codeinline\">for i in tqdm(range(train.shape[0])):</span>\n    <span style='font-family: \"SFMono-Regular\",Consolas,\"Liberation Mono\",Menlo,Courier,monospace;' class=\"codeinline\">img = image.load_img(train['image_ID'][i]+'.JPG', target_size=(28,28,1), grayscale=False)</span>\n    <span style='font-family: \"SFMono-Regular\",Consolas,\"Liberation Mono\",Menlo,Courier,monospace;' class=\"codeinline\">img = image.img_to_array(img)</span>\n    <span style='font-family: \"SFMono-Regular\",Consolas,\"Liberation Mono\",Menlo,Courier,monospace;' class=\"codeinline\">img = img/255</span>\n    <span style='font-family: \"SFMono-Regular\",Consolas,\"Liberation Mono\",Menlo,Courier,monospace;' class=\"codeinline\">train_img.append(img)</span>\n<span style='font-family: \"SFMono-Regular\",Consolas,\"Liberation Mono\",Menlo,Courier,monospace;' class=\"codeinline\">X = np.array(train_image)</span></pre></div><p><span style=\"font-weight: bold;\" class=\"\">Apply transformations</span></p><p>After storing the training images into a vector, we split them in two sets by using the 20/80 rule. We will use 80 percent of the images to train the model and the other 20 percent to test it. </p><p>Now we set up the convolutional neural network (CNN). Since we are building the CNN from scratch we need to specify a few parameters associated with the model. We specify the input shape to be the same size as the vector holding the images. For the pooling layer we use a size of 2. The dropout is 0.25 and for the activation function we use a softmax.</p><div class=\"codeblock\"><pre><span style='font-family: \"SFMono-Regular\",Consolas,\"Liberation Mono\",Menlo,Courier,monospace;' class=\"codeinline\">model = Sequential()</span>\n<span style='font-family: \"SFMono-Regular\",Consolas,\"Liberation Mono\",Menlo,Courier,monospace;' class=\"codeinline\">model.add(Conv2D(32, kernel_size=(3, 3),activation='relu',input_shape=(28,28,1)))</span>\n<span style='font-family: \"SFMono-Regular\",Consolas,\"Liberation Mono\",Menlo,Courier,monospace;' class=\"codeinline\">model.add(Conv2D(64, (3, 3), activation='relu'))</span>\n<span style='font-family: \"SFMono-Regular\",Consolas,\"Liberation Mono\",Menlo,Courier,monospace;' class=\"codeinline\">model.add(MaxPoolong2D(pool_size=2, 2)))</span>\n<span style='font-family: \"SFMono-Regular\",Consolas,\"Liberation Mono\",Menlo,Courier,monospace;' class=\"codeinline\">model.add(Dropout(0.25))</span>\n<span style='font-family: \"SFMono-Regular\",Consolas,\"Liberation Mono\",Menlo,Courier,monospace;' class=\"codeinline\">model.add(Flatten())</span>\n<span style='font-family: \"SFMono-Regular\",Consolas,\"Liberation Mono\",Menlo,Courier,monospace;' class=\"codeinline\">model.add(Dense(128, activation='relu'))</span>\n<span style='font-family: \"SFMono-Regular\",Consolas,\"Liberation Mono\",Menlo,Courier,monospace;' class=\"codeinline\">model.add(Dropout(0.5))</span>\n<span style='font-family: \"SFMono-Regular\",Consolas,\"Liberation Mono\",Menlo,Courier,monospace;' class=\"codeinline\">model.add(Dense(10, activation='softmax'))</span></pre></div><p>The architecture of the CCN is shown below.</p><p><div class=\"image\">\n<img src=\"https://zindpublic.blob.core.windows.net/public/uploads/image_attachment/image/381/d6574252-ffaa-4217-90a7-056788cd90ce.png\"> </div></p><p><span style=\"font-weight: bold;\" class=\"\">Model training</span></p><p>We train the model by using an Adam optimiser, and set the epochs to 10.  For the objective function we use a &lsquo;sparse categorical cross-entropy&rsquo; and we set our metric to accuracy since we&rsquo;re interested in measuring the log loss of the model. Logarithmic loss (related to cross-entropy) measures the performance of a classification model where the prediction input is a probability value between 0 and 1. <a href=\"http://wiki.fast.ai/index.php/Log_Loss\" target=\"_blank\" rel=\"noreferrer noopener\">You can read more about log loss here</a>. After defining those parameters, we fit the model on the training data.</p><div class=\"codeblock\">\n<pre>model.compile(loss='sparse_categorical_crossentropy, optimizer='Adam',metrics=['accuracy'])\nmodel.fit(X_train, y_train,epochs=10) </pre>\n<pre>Epoch 1/10\n3220/3220 [==============================] - 7s 2ms/step - loss: 0.4589 - acc: 0.7870\nEpoch 2/10\n3220/3220 [==============================] - 7s 2ms/step - loss: 0.3132 - acc: 0.8618\nEpoch 3/10\n3220/3220 [==============================] - 7s 2ms/step - loss: 0. 2594 - acc: 0.8910\nEpoch 4/10\n3220/3220 [==============================] - 7s 2ms/step - loss: 0.2341 - acc: 0.8994\nEpoch 5/10\n3220/3220 [==============================] - 7s 2ms/step - loss: 0.2005 - acc: 0.9168\nEpoch 6/10\n3220/3220 [==============================] - 7s 2ms/step - loss: 0.1740 - acc: 0.9326\nEpoch 7/10\n3220/3220 [==============================] - 7s 2ms/step - loss: 0.1482 - acc: 0.9407\nEpoch 8/10 \n3220/3220 [==============================] - 7s 2ms/step - loss: 0.1458 - acc: 0.9422\nEpoch 9/10\n3220/3220 [==============================] - 7s 2ms/step - loss: 0.1208 - acc: 0.9559\nEpoch 10/10\n3220/3220 [==============================] - 7s 2ms/step - loss: 0.1264 - acc: 0.9506</pre>\n</div><p><span style=\"font-weight: bold;\" class=\"\">Prediction on images</span></p><p>We now apply the model on the test data, this is data the model has never interacted with. The unseen images are 1,650 images. This is the most interesting part, as we now get to see how the model performs.</p><div class=\"codeblock\"><pre>y_score = model.predict_proba(X_test)\nprint(y_score)\n[[9.8533183e-01 1.4668099e-02]\n [9.9933630e-01 4.0945363e-01\n ...\n [7.5465256e-01 2.4534738e-01]\n [3.3280409e-03 9.9667192e-01]\n [7.4173373e-01 2.5826630e-01]]\n    test = pd.read_csv('test_ids_only.csv')</pre></div><p></p><p><div class=\"image\">\n<img src=\"https://zindpublic.blob.core.windows.net/public/uploads/image_attachment/image/382/a20f5fcc-d9a6-4c70-bee2-70edd4fab0b9.jpg\"> </div></p><div class=\"codeblock\"><pre>Saving the results in a text file.\nnp.savetxt(\"sample.csv\",sample_submission,deliiter = \",\")\nUsing the clip function to improve the log loss.\nsample_submission1 = model.predict_proba(Test).clip(0.1,0.3)\nSaving the results in a text file.\nnp.savetxt(\"sample.csv\",sample_submission1,delimiter = \",\")</pre></div><p>The model handled the image quite well. Remember the objective was to detect potholes in an image with high accuracy. The log loss of the model is good.  To improve the model further we can use the clip function. This function maximizes the log loss of the model. The log was 1.43 but using the clip function the log loss is at 0.65.</p><p><span style=\"font-weight: bold;\" class=\"\">Summary</span></p><p>I have shown here how easily you can build CNNs and apply them to real-world applications. All this was achieved using open-source tools, and it only took a few hours to compile this solution.</p><p><span style=\"font-weight: bold;\" class=\"\">About the author</span></p><p>Blessing Magabane is a full stack data scientist at Altron Bytes Managed Solutions (<a href=\"https://www.linkedin.com/in/blessing-magabane-8b6600ab/\" target=\"_blank\" rel=\"noreferrer noopener\">LinkedIn</a> | <a href=\"https://zindi.africa/users/Blessingkok\" target=\"_blank\" rel=\"noreferrer noopener\">Zindi</a> | <a href=\"https://github.com/blessingkoketso\" target=\"_blank\" rel=\"noreferrer noopener\">GitHub</a>). He is passionate about data science and solving problems using machine learning. For collaboration on data science projects, please get in touch with him via LinkedIn.</p>","published_at":"2020-04-16T12:59:32.142Z"}},"queries":{"\"detecting-potholes-with-deep-learning-a-convolution-neural-network-tutorial-using-the-miia-pothole-classification-challenge\"":{"data":"detecting-potholes-with-deep-learning-a-convolution-neural-network-tutorial-using-the-miia-pothole-classification-challenge","loading":false,"error":null}}},"fullCompetitions":{},"fullDiscussions":{"data":{},"queries":{"default":{"loading":false,"error":null}}},"fullJobs":{"data":{},"queries":{}},"jobs":{"data":{},"queries":{}},"jobApplications":{"data":{},"queries":{}},"myTeams":{},"notificationSubscriptions":{"data":{},"queries":{}},"participations":{"data":{},"queries":{}},"submissions":{"data":{},"queries":{}},"submissionLimits":{"data":{},"queries":{}},"teams":{"data":{},"queries":{}},"userDiscussions":{"data":{},"queries":{}},"userParticipations":{"data":{},"queries":{}},"userProfiles":{"users":{}},"users":{"data":{},"queries":{}}}</script>
    
    <script>
      window.ga =
        window.ga ||
        function () {
          ;(ga.q = ga.q || []).push(arguments)
        }
      ga.l = +new Date()
      ga("create", "UA-125419148-1", "auto")
      ga("send", "pageview")
      ga('set', 'appName', 'zindi.web')
      ga('set', 'dimension1', 'nextgen');
    </script>
    <script async="" src="./Detecting potholes with deep learning_ a Convolution Neural Network tutorial using the MIIA Pothole Classification Challenge - Zindi_files/analytics.js"></script>
     
    <noscript><iframe
        src="https://www.googletagmanager.com/ns.html?id=GTM-KRG85D8"
        height="0"
        width="0"
        style="display: none; visibility: hidden"
      ></iframe
    ></noscript>
    
  <script>!function(l){function e(e){for(var r,t,n=e[0],o=e[1],u=e[2],i=0,a=[];i<n.length;i++)t=n[i],Object.prototype.hasOwnProperty.call(p,t)&&p[t]&&a.push(p[t][0]),p[t]=0;for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(l[r]=o[r]);for(s&&s(e);a.length;)a.shift()();return c.push.apply(c,u||[]),f()}function f(){for(var e,r=0;r<c.length;r++){for(var t=c[r],n=!0,o=1;o<t.length;o++){var u=t[o];0!==p[u]&&(n=!1)}n&&(c.splice(r--,1),e=i(i.s=t[0]))}return e}var t={},p={runtime:0},c=[];function i(e){if(t[e])return t[e].exports;var r=t[e]={i:e,l:!1,exports:{}};return l[e].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=l,i.c=t,i.d=function(e,r,t){i.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(r,e){if(1&e&&(r=i(r)),8&e)return r;if(4&e&&"object"==typeof r&&r&&r.__esModule)return r;var t=Object.create(null);if(i.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:r}),2&e&&"string"!=typeof r)for(var n in r)i.d(t,n,function(e){return r[e]}.bind(null,n));return t},i.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(r,"a",r),r},i.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},i.p="https://assets.zindi.africa/";var r=(n=window.webpackJsonp=window.webpackJsonp||[]).push.bind(n);n.push=e;for(var n=n.slice(),o=0;o<n.length;o++)e(n[o]);var s=r;f()}([]);
//# sourceMappingURL=runtime.8d4eb9324d7c3d54849b.js.map</script><script type="text/javascript" src="./Detecting potholes with deep learning_ a Convolution Neural Network tutorial using the MIIA Pothole Classification Challenge - Zindi_files/vendor.019171b12285f6597772.js" defer=""></script><script type="text/javascript" src="./Detecting potholes with deep learning_ a Convolution Neural Network tutorial using the MIIA Pothole Classification Challenge - Zindi_files/bundle.9c8d652f1bf8225cb2ca.js" defer=""></script>

<div class="ReactModalPortal"></div>
<script type="text/javascript" id="">(function(a,e,f,g,b,c,d){a[b]=a[b]||function(){(a[b].a=a[b].a||[]).push(arguments)};a[b].l=1*new Date;c=e.createElement(f);d=e.getElementsByTagName(f)[0];c.async=1;c.src=g;d.parentNode.insertBefore(c,d)})(window,document,"script","https://mc.yandex.ru/metrika/tag.js","ym");ym(67869277,"init",{clickmap:!0,trackLinks:!0,accurateTrackBounce:!0,webvisor:!0});</script>
<noscript><div><img src="https://mc.yandex.ru/watch/67869277" style="position:absolute; left:-9999px;" alt=""></div></noscript>
<div id="fatkun-drop-panel">
        <a id="fatkun-drop-panel-close-btn">×</a>
            <div id="fatkun-drop-panel-inner">
                <div class="fatkun-content">
                    <svg class="fatkun-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5892"><path d="M494.933333 782.933333c2.133333 2.133333 4.266667 4.266667 8.533334 6.4h8.533333c6.4 0 10.666667-2.133333 14.933333-6.4l2.133334-2.133333 275.2-275.2c8.533333-8.533333 8.533333-21.333333 0-29.866667-8.533333-8.533333-21.333333-8.533333-29.866667 0L533.333333 716.8V128c0-12.8-8.533333-21.333333-21.333333-21.333333s-21.333333 8.533333-21.333333 21.333333v588.8L249.6 475.733333c-8.533333-8.533333-21.333333-8.533333-29.866667 0-8.533333 8.533333-8.533333 21.333333 0 29.866667l275.2 277.333333zM853.333333 874.666667H172.8c-12.8 0-21.333333 8.533333-21.333333 21.333333s8.533333 21.333333 21.333333 21.333333H853.333333c12.8 0 21.333333-8.533333 21.333334-21.333333s-10.666667-21.333333-21.333334-21.333333z" p-id="5893"></path></svg>
                    <div class="fatkun-title">Drag and Drop</div>
                    <div class="fatkun-desc">The image will be downloaded</div>
                </div>
            </div>
    </div></body></html>